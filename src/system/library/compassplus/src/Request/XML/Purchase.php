<?php
 namespace Compassplus\Sdk\Request\XML; use Compassplus\Sdk\Operation\Operation; use Compassplus\Sdk\Request\DataProvider; use Compassplus\Sdk\Service; use UnexpectedValueException; class Purchase extends DataProvider { protected $operation; public function __construct(Operation $operation) { $this->operation = $operation; } public function getRequestData() { $service = new Service(); $arr = [ "Request" => [ "Operation" => "CreateOrder", "Language" => "", "Order" => [ "OrderType" => "Purchase", "Merchant" => $this->operation->merchant->getId(), "Amount" => $this->operation->order->getAmount(), "Currency" => $this->operation->order->getCurrency(), "Description" => $this->operation->order->getDescription(), "ApproveURL" => $this->operation->merchant->getApproveUrl(), "CancelURL" => $this->operation->merchant->getCancelUrl(), "DeclineURL" => $this->operation->merchant->getDeclineUrl() ] ] ]; if (!empty($this->operation->customer->getPhone())) { $arr['Request']['Order']['phone'] = $this->operation->customer->getPhone(); } if (!empty($this->operation->customer->getEmail())) { $arr['Request']['Order']['email'] = $this->operation->customer->getEmail(); } $xml = $service->write("TKKPG", $arr); if ($xml) { return $xml; } else { throw new UnexpectedValueException("XML is not generated"); } } } 